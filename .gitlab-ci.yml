stages:
  - build_xml
  - build_html
  - deploy_gitlab

# generate XML with Doxygen
generate-xml:
  stage: build_xml
  image: alpine
  script:
    # add Doxygen and git
    - apk update
    - apk add doxygen git
    # clone evalhyd core C++ library
    - git clone https://gitlab.irstea.fr/HYCAR-Hydro/evalhyd/evalhyd.git
    # generate XML for C++ API with Doxygen
    - mkdir -p __build/xml/cpp
    - (cd __source/cpp && doxygen Doxyfile-gitlab)
  artifacts:
    paths:
      - __build/xml/
    expire_in: 1 hour

# generate HTML with Sphinx
generate-html:
  stage: build_html
  image: python:3.9.13
  script:
    # install required packages to build docs
    - python -m pip install -r requirements.txt
    # generate docs with Sphinx
    - sphinx-build -b html __source public
  dependencies:
    - generate-xml
  artifacts:
    paths:
      - public

# deploy to GitLab Page
pages:
  stage: deploy_gitlab
  dependencies:
    - generate-html
  artifacts:
    paths:
      - public
